<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: 概述</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__r_e_a_d_m_e.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">概述 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>这次要搞中断了 </p><h2>8259A</h2>
<p>推荐文章:<a href="https://blog.csdn.net/ustc_dylan/article/details/4106436">8259A中断控制器详细介绍</a>,可以结合PPT的大致结构图来了解下它与CPU的联系: </p><div class="image">
<img src="https://lh3.googleusercontent.com/-MI8KrPPX3EU/Wsb83DRzPfI/AAAAAAAAGkw/h85GThCDHz4cW5xGGw9vANnCOPlaKOinwCHMYCw/s0/8259A%25E4%25B8%258ECPU.png" alt="1"/>
</div>
 <h2>8259A的I/O端口</h2>
<ul>
<li>每个可编程中断控制器8259A都有两个I/O端口</li>
<li>主8259A所对应的端口地址为20h和21h</li>
<li>从8259A所对应的端口地址为A0h和A1h</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Chip - Purpose  </th><th class="markdownTableHeadNone">I/O port   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Master PIC - Command  </td><td class="markdownTableBodyNone">0x0020   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Master PIC - Data  </td><td class="markdownTableBodyNone">0x0021   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Slave PIC - Command  </td><td class="markdownTableBodyNone">0x00A0   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Slave PIC - Data  </td><td class="markdownTableBodyNone">0x00A1   </td></tr>
</table>
<p>偶数的端口是指定命令,奇数的端口是是传输数据 参考资料:<a href="https://wiki.osdev.org/8259_PIC">8259 PIC</a></p>
<h3>EOI的具体实现</h3>
<p>BIOS在加载时会初始化好8259A以准备接收中断,具体涉及到操作8259A内部的寄存器会比较复杂,不同的端口会有不同的分工: </p><div class="image">
<img src="https://lh3.googleusercontent.com/-qZ5pLUVwAug/Wsb_Pcx06TI/AAAAAAAAGk8/RgXiOWoIadwkwjitONwFy59PHpG2xKqdQCHMYCw/s0/chrome_2018-04-06_13-01-48.png" alt="2"/>
</div>
<p>这个对于主从8259A只存在端口的不同,操作范围是一致的.</p>
<p>通过IN/OUT指令可以实现相关操作,比较常用的是: </p><div class="fragment"><div class="line">mov al,20h          ; AL = EOI</div><div class="line">out 20h,al          ; 发送EOI到主8529A</div><div class="line">out 0A0h,al</div><div class="line">iret</div></div><!-- fragment --><p> iret仅仅是一个跳转指令,这里不再赘述</p>
<p>至于为什么朝端口发送20h,技术文档了解一下:<a href="https://pdos.csail.mit.edu/6.828/2014/readings/hardware/8259A.pdf">技术文档</a></p>
<p>其中有一段: &gt;There are two forms of EOI command: Specific and Non-Specific. When the 8259A is operated in modes which perserve the fully nested structure, it can determine which IS bit to reset on EOI. When a NonSpecific EOI command is issued the 8259A will automatically reset the highest IS bit of those that are set, since in the fully nested mode the highest IS level was necessarily the last level acknowledged and serviced. A non-specific EOI can be issued with OCW2 (EOI e 1, SL e 0, R e 0).</p>
<div class="image">
<img src="https://lh3.googleusercontent.com/-pMTlyzlWGZE/WscAkkBTeTI/AAAAAAAAGlI/9jAVx9JKrUANIdmuc0eHRuusV22MHiTfgCHMYCw/s0/chrome_2018-04-06_13-07-28.png" alt="3"/>
</div>
<p>20H的由来到此结束</p>
<h2>段间转移实现</h2>
<h2>中断指令详解</h2>
<h3>PUSHF/POPF</h3>
<h3>PUSHA/POPA</h3>
<h3>INT</h3>
<h3>IRET</h3>
<p>&gt;the IRET instruction pops the return instruction pointer, return code segment selector, and EFLAGS image from the stack to the EIP, CS, and EFLAGS registers, respectively, and then resumes execution of the interrupted program or procedure. If the return is to another privilege level, the IRET instruction also pops the stack pointer and SS from the stack, before resuming program execution.</p>
<h2>INT 09H</h2>
<h2>临时</h2>
<ul>
<li>系统爆内存了,需要大改</li>
<li>键盘扫描码还不是很清楚 <h1>项目进度</h1>
</li>
</ul>
<ul>
<li>[x] 时钟中断自定义</li>
<li>[x] 键盘响应自定义</li>
<li>[x] 自由中断号调用</li>
<li>[x] 三项新功能</li>
<li>[x] 系统测试</li>
<li>[ ] FAT文件系统 </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
